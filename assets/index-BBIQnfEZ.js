import{t as _}from"./formatting-B24v2g9C.js";import{u as H}from"./accounts-CPmDXvZT.js";import{s as q,l as G,t as K,a as Q,v as W,w as X,b as Y,o as Z,x as ee,r as ae,y as te,d as le,z as ne,A as oe,e as se,B as re,C as ie,j as ce,f as L,g as ue,h as de,i as R,k as me}from"./VCard-DO0BZtUi.js";import{a as ve,V as fe}from"./VSelect-DGFgWUf-.js";import{p as ye,a1 as be,m as pe,a as ke,b as Ve,g as _e,n as he,f as h,d as we,t as Ce,a2 as xe,c as s,y as D,A as Pe,r as V,w as ge,o as Se,N as n,C as T,D as u,O as B,H as N,I as d,L as c,J as i,ak as I}from"./index-BM4827qe.js";import{a as P}from"./VInput-Itdv4raA.js";import{V as Ae}from"./VSpacer-Dj1D5w-H.js";import{V as Le}from"./VSwitch-D7XZRAfC.js";import"./VTextField-CFevf7Dy.js";import"./VChip-BRNZ0QEs.js";const Re=q("v-alert-title"),Te=["success","info","warning","error"],Be=ye({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:be,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>Te.includes(e)},...pe(),...G(),...K(),...Q(),...W(),...X(),...Y(),...ke(),...Ve(),...Z({variant:"flat"})},"VAlert"),Ne=_e()({name:"VAlert",props:Be(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,f){let{emit:w,slots:a}=f;const y=he(e,"modelValue"),l=h(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),b=h(()=>({color:e.color??e.type,variant:e.variant})),{themeClasses:m}=we(e),{colorClasses:v,colorStyles:C,variantClasses:r}=ee(b),{densityClasses:o}=ae(e),{dimensionStyles:t}=te(e),{elevationClasses:p}=le(e),{locationStyles:z}=ne(e),{positionClasses:$}=oe(e),{roundedClasses:O}=se(e),{textColorClasses:j,textColorStyles:E}=re(Ce(e,"borderColor")),{t:F}=xe(),g=h(()=>({"aria-label":F(e.closeLabel),onClick(x){y.value=!1,w("click:close",x)}}));return()=>{const x=!!(a.prepend||l.value),J=!!(a.title||e.title),M=!!(a.close||e.closable);return y.value&&s(e.tag,{class:["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},m.value,v.value,o.value,p.value,$.value,O.value,r.value,e.class],style:[C.value,t.value,z.value,e.style],role:"alert"},{default:()=>{var S,A;return[ie(!1,"v-alert"),e.border&&s("div",{key:"border",class:["v-alert__border",j.value],style:E.value},null),x&&s("div",{key:"prepend",class:"v-alert__prepend"},[a.prepend?s(L,{key:"prepend-defaults",disabled:!l.value,defaults:{VIcon:{density:e.density,icon:l.value,size:e.prominent?44:28}}},a.prepend):s(ce,{key:"prepend-icon",density:e.density,icon:l.value,size:e.prominent?44:28},null)]),s("div",{class:"v-alert__content"},[J&&s(Re,{key:"title"},{default:()=>{var k;return[((k=a.title)==null?void 0:k.call(a))??e.title]}}),((S=a.text)==null?void 0:S.call(a))??e.text,(A=a.default)==null?void 0:A.call(a)]),a.append&&s("div",{key:"append",class:"v-alert__append"},[a.append()]),M&&s("div",{key:"close",class:"v-alert__close"},[a.close?s(L,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var k;return[(k=a.close)==null?void 0:k.call(a,{props:g.value})]}}):s(P,D({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},g.value),null)])]}})}}}),Ie={class:"font-weight-black mx-1"},Ue={class:"text-caption mx-1"},De={class:"text-caption mx-1"},ze=c("p",null,"Select the account to pay with",-1),$e={class:"d-flex align-center"},Oe={class:"font-weight-black"},je=Pe({__name:"index",setup(e){const f=H(),w=h(()=>f.accounts.filter(r=>{var o;return r.bank.currency==((o=l.value)==null?void 0:o.ccy)})),a=V(),y=V(),l=V(),b=V(0),m=V(!1);ge(a,async r=>{var o;if(r&&((o=l.value)!=null&&o.execAddress)){const t=await f.currentApproval(r,l.value.execAddress);b.value=t}});function v(r,o){const t=new URL(y.value.href);r&&t.searchParams.append("r",btoa(JSON.stringify(r))),o&&t.searchParams.append("error",o),window.location.href=t.href}async function C(){if(!a.value)return;l.value||v(void 0,"No payment instruction found");const r=m.value?l.value.amount:b.value+l.value.amount,{tx:o,error:t}=await f.approve(a.value,l.value.execAddress,r);if(t)v(void 0,t);else{const p={msg:"Payment successful",tx:o,id:l.value.id,account:a.value.address,amount:l.value.amount,ccy:l.value.ccy};v(p)}}return Se(()=>{const r=new URL(window.location.href);if(!r.searchParams.has("redirect"))throw new Error("No redirect URL found in the URL");y.value=new URL(r.searchParams.get("redirect")),r.searchParams.has("i")||v(void 0,"No payment instruction found in the URL");const o=atob(r.searchParams.get("i"));l.value=JSON.parse(o),f.loadAccounts()}),(r,o)=>n(l)?(N(),T(ue,{key:0},{default:u(()=>[s(de,null,{default:u(()=>[d(" Payment Validation ")]),_:1}),s(R,{class:"mx-3"},{default:u(()=>[c("ul",null,[c("li",null,[d(" Pay "),c("span",Ie,i(n(_)(n(l).amount))+" "+i(n(l).ccy),1)]),c("li",null,"To: "+i(n(l).beneficiary)+" ("+i(n(l).iban)+")",1),c("li",null,[d(" Reference: "),c("span",Ue,i(n(l).id),1),d("("+i(n(y).origin)+") ",1)]),c("li",null,[d(" Allowing "),c("span",De,i(n(l).execAddress),1),d("to debit your account ")])])]),_:1}),s(R,null,{default:u(()=>[ze,s(ve,{items:n(w),"item-title":"name","item-value":"address","return-object":"","single-line":"",clearable:"","model-value":n(a),"onUpdate:modelValue":o[0]||(o[0]=t=>I(a)?a.value=t:null)},{selection:u(({item:t})=>[c("div",null,i(t.raw.name)+" : "+i(n(_)(t.raw.balance,t.raw.bank.decimals))+" "+i(t.raw.bank.currency),1)]),item:u(({item:t,props:p})=>[s(fe,D(p,{title:""}),{default:u(()=>[d(i(t.raw.name)+" : "+i(n(_)(t.raw.balance,t.raw.bank.decimals))+" "+i(t.raw.bank.currency),1)]),_:2},1040)]),_:1},8,["items","model-value"]),n(a)&&n(b)>0?(N(),T(Ne,{key:0,density:"comfortable",type:"info",variant:"outlined"},{default:u(()=>[c("div",$e,[d(" Current authorization: "),c("span",Oe,i(n(_)(n(b),n(a).bank.decimals))+" "+i(n(a).bank.currency),1),s(Ae),s(Le,{label:n(m)?"Replace":"Add",density:"compact","hide-details":"",modelValue:n(m),"onUpdate:modelValue":o[1]||(o[1]=t=>I(m)?m.value=t:null)},null,8,["label","modelValue"])])]),_:1})):B("",!0)]),_:1}),s(me,null,{default:u(()=>[s(P,{color:"primary",disabled:!n(a),onClick:C},{default:u(()=>[d("Confirm")]),_:1},8,["disabled"]),s(P,{color:"error",onClick:o[2]||(o[2]=t=>v(void 0,"cancel by user"))},{default:u(()=>[d("Cancel")]),_:1})]),_:1})]),_:1})):B("",!0)}}),U={};typeof U=="function"&&U(je);export{je as default};
