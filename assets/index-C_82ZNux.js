import{t as w}from"./formatting-CrmIf10V.js";import{u as S}from"./accounts-CDDCG86r.js";import{g as N,h as R,i as h,k as L}from"./VCard-B3Oprnt7.js";import{a as U,V as T}from"./VSelect-omC-gu8C.js";import{V as B}from"./VAlert-BGu6s0xv.js";import{V as J}from"./VSpacer-oWN8IlRE.js";import{V as O}from"./VSwitch-BR8oT2uV.js";import{a as _}from"./VInput-CZnSWQNW.js";import{A as I,f as D,r as p,w as M,o as j,O as a,D as V,F as c,P as x,I as k,c as i,J as u,M as r,K as l,ax as g,y as z}from"./index-CjOFXEkW.js";import"./VTextField-BeZf-9lP.js";import"./VChip-Bl0RUETQ.js";/* empty css              */const E={class:"font-weight-black mx-1"},F={class:"text-caption mx-1"},K={class:"text-caption mx-1"},$=r("p",null,"Select the account to pay with",-1),q={class:"d-flex align-center"},G={class:"font-weight-black"},H=I({__name:"index",setup(Q){const v=S(),P=D(()=>v.accounts.filter(n=>{var o;return n.bank.currency==((o=t.value)==null?void 0:o.ccy)})),s=p(),b=p(),t=p(),y=p(0),m=p(!1);M(s,async n=>{var o;if(n&&((o=t.value)!=null&&o.execAddress)){const e=await v.currentApproval(n,t.value.execAddress);y.value=e}});function f(n,o){var d;const e=new URL(b.value.href);n&&e.searchParams.append("r",btoa(JSON.stringify(n))),o&&(n={msg:"Payment failed",error:o,id:t.value.id,account:(d=s.value)==null?void 0:d.address,amount:t.value.amount,ccy:t.value.ccy},e.searchParams.append("r",btoa(JSON.stringify(n)))),window.location.href=e.href}async function C(){if(!s.value)return;t.value||f(void 0,"No payment instruction found");const n=m.value?t.value.amount:y.value+t.value.amount,{tx:o,error:e}=await v.approve(s.value,t.value.execAddress,n);if(e)f(void 0,e);else{const d={msg:"Payment successful",tx:o,id:t.value.id,account:s.value.address,amount:t.value.amount,ccy:t.value.ccy};f(d)}}return j(()=>{const n=new URL(window.location.href);if(!n.searchParams.has("redirect"))throw new Error("No redirect URL found in the URL");b.value=new URL(n.searchParams.get("redirect")),n.searchParams.has("i")||f(void 0,"No payment instruction found in the URL");const o=atob(n.searchParams.get("i"));t.value=JSON.parse(o),v.loadAccounts()}),(n,o)=>a(t)?(k(),V(N,{key:0},{default:c(()=>[i(R,null,{default:c(()=>[u(" Payment Validation ")]),_:1}),i(h,{class:"mx-3"},{default:c(()=>[r("ul",null,[r("li",null,[u(" Pay "),r("span",E,l(a(w)(a(t).amount))+" "+l(a(t).ccy),1)]),r("li",null,"To: "+l(a(t).beneficiary)+" ("+l(a(t).iban)+")",1),r("li",null,[u(" Reference: "),r("span",F,l(a(t).id),1),u("("+l(a(b).origin)+") ",1)]),r("li",null,[u(" Allowing "),r("span",K,l(a(t).execAddress),1),u("to debit your account ")])])]),_:1}),i(h,null,{default:c(()=>[$,i(U,{items:a(P),"item-title":"name","item-value":"address","return-object":"","single-line":"",clearable:"","no-data-text":"Ask your bank to associate your wallet to your account","model-value":a(s),"onUpdate:modelValue":o[0]||(o[0]=e=>g(s)?s.value=e:null)},{selection:c(({item:e})=>[r("div",null,l(e.raw.name)+" : "+l(a(w)(e.raw.balance,e.raw.bank.decimals))+" "+l(e.raw.bank.currency),1)]),item:c(({item:e,props:d})=>[i(T,z(d,{title:""}),{default:c(()=>[u(l(e.raw.name)+" : "+l(a(w)(e.raw.balance,e.raw.bank.decimals))+" "+l(e.raw.bank.currency),1)]),_:2},1040)]),_:1},8,["items","model-value"]),a(s)&&a(y)>0?(k(),V(B,{key:0,density:"comfortable",type:"info",variant:"outlined"},{default:c(()=>[r("div",q,[u(" Current authorization: "),r("span",G,l(a(w)(a(y),a(s).bank.decimals))+" "+l(a(s).bank.currency),1),i(J),i(O,{label:a(m)?"Replace":"Add",density:"compact","hide-details":"",modelValue:a(m),"onUpdate:modelValue":o[1]||(o[1]=e=>g(m)?m.value=e:null)},null,8,["label","modelValue"])])]),_:1})):x("",!0)]),_:1}),i(L,null,{default:c(()=>[i(_,{color:"primary",disabled:!a(s),onClick:C},{default:c(()=>[u("Confirm")]),_:1},8,["disabled"]),i(_,{color:"error",onClick:o[2]||(o[2]=e=>f(void 0,"cancel by user"))},{default:c(()=>[u("Cancel")]),_:1})]),_:1})]),_:1})):x("",!0)}}),A={};typeof A=="function"&&A(H);export{H as default};
