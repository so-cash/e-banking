import{u as Pe}from"./accounts-CDDCG86r.js";import{ap as se,af as de,p as ve,m as Re,a as Ne,g as fe,f as x,aq as Ie,W as lt,a7 as nt,r as P,s as W,n as xe,w as O,$ as Ve,Z as ut,u as ot,c as o,R as Y,y as Q,ar as st,J as oe,as as rt,ai as it,at as ct,A as Te,au as pe,B as dt,I as D,D as q,F as A,O as z,K as U,P as X,M as J,o as vt,N as ke,G as ft}from"./index-CjOFXEkW.js";import{t as mt}from"./formatting-CrmIf10V.js";/* empty css              */import{m as gt,u as yt,t as H,c as bt,d as ht,e as xt,V as we,f as Vt}from"./VSelect-omC-gu8C.js";import{m as pt,V as Z,f as kt}from"./VTextField-BeZf-9lP.js";import{t as wt,v as Ct,w as St,j as Ce,f as _t,x as At,g as Pt,i as Rt,k as Nt}from"./VCard-B3Oprnt7.js";import{m as It,u as Tt,_ as Ft,V as Et}from"./filter-CJ8vjxkn.js";import{d as Lt,a as Fe}from"./VInput-CZnSWQNW.js";import{b as $t,V as Dt}from"./VChip-Bl0RUETQ.js";import{V as jt}from"./VContainer-B4WSKeZT.js";const Ee=se.reduce((e,l)=>(e[l]={type:[Boolean,String,Number],default:!1},e),{}),Le=se.reduce((e,l)=>{const s="offset"+de(l);return e[s]={type:[String,Number],default:null},e},{}),$e=se.reduce((e,l)=>{const s="order"+de(l);return e[s]={type:[String,Number],default:null},e},{}),Se={col:Object.keys(Ee),offset:Object.keys(Le),order:Object.keys($e)};function Mt(e,l,s){let a=e;if(!(s==null||s===!1)){if(l){const u=l.replace(e,"");a+=`-${u}`}return e==="col"&&(a="v-"+a),e==="col"&&(s===""||s===!0)||(a+=`-${s}`),a.toLowerCase()}}const Bt=["auto","start","end","center","baseline","stretch"],Ut=ve({cols:{type:[Boolean,String,Number],default:!1},...Ee,offset:{type:[String,Number],default:null},...Le,order:{type:[String,Number],default:null},...$e,alignSelf:{type:String,default:null,validator:e=>Bt.includes(e)},...Re(),...Ne()},"VCol"),ue=fe()({name:"VCol",props:Ut(),setup(e,l){let{slots:s}=l;const a=x(()=>{const u=[];let v;for(v in Se)Se[v].forEach(i=>{const p=e[i],k=Mt(v,i,p);k&&u.push(k)});const y=u.some(i=>i.startsWith("v-col-"));return u.push({"v-col":!y||!e.cols,[`v-col-${e.cols}`]:e.cols,[`offset-${e.offset}`]:e.offset,[`order-${e.order}`]:e.order,[`align-self-${e.alignSelf}`]:e.alignSelf}),u});return()=>{var u;return Ie(e.tag,{class:[a.value,e.class],style:e.style},(u=s.default)==null?void 0:u.call(s))}}}),me=["start","end","center"],De=["space-between","space-around","space-evenly"];function ge(e,l){return se.reduce((s,a)=>{const u=e+de(a);return s[u]=l(),s},{})}const Ot=[...me,"baseline","stretch"],je=e=>Ot.includes(e),Me=ge("align",()=>({type:String,default:null,validator:je})),qt=[...me,...De],Be=e=>qt.includes(e),Ue=ge("justify",()=>({type:String,default:null,validator:Be})),Kt=[...me,...De,"stretch"],Oe=e=>Kt.includes(e),qe=ge("alignContent",()=>({type:String,default:null,validator:Oe})),_e={align:Object.keys(Me),justify:Object.keys(Ue),alignContent:Object.keys(qe)},Gt={align:"align",justify:"justify",alignContent:"align-content"};function Qt(e,l,s){let a=Gt[e];if(s!=null){if(l){const u=l.replace(e,"");a+=`-${u}`}return a+=`-${s}`,a.toLowerCase()}}const Wt=ve({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:je},...Me,justify:{type:String,default:null,validator:Be},...Ue,alignContent:{type:String,default:null,validator:Oe},...qe,...Re(),...Ne()},"VRow"),Ae=fe()({name:"VRow",props:Wt(),setup(e,l){let{slots:s}=l;const a=x(()=>{const u=[];let v;for(v in _e)_e[v].forEach(y=>{const i=e[y],p=Qt(v,y,i);p&&u.push(p)});return u.push({"v-row--no-gutters":e.noGutters,"v-row--dense":e.dense,[`align-${e.align}`]:e.align,[`justify-${e.justify}`]:e.justify,[`align-content-${e.alignContent}`]:e.alignContent}),u});return()=>{var u;return Ie(e.tag,{class:["v-row",a.value,e.class],style:e.style},(u=s.default)==null?void 0:u.call(s))}}});function zt(e,l,s){if(l==null)return e;if(Array.isArray(l))throw new Error("Multiple matches is not implemented");return typeof l=="number"&&~l?o(Y,null,[o("span",{class:"v-combobox__unmask"},[e.substr(0,l)]),o("span",{class:"v-combobox__mask"},[e.substr(l,s)]),o("span",{class:"v-combobox__unmask"},[e.substr(l+s)])]):e}const Ht=ve({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...It({filterKeys:["title"]}),...gt({hideNoData:!0,returnObject:!0}),...lt(pt({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...wt({transition:!1})},"VCombobox"),Xt=fe()({name:"VCombobox",props:Ht(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,l){var ye;let{emit:s,slots:a}=l;const{t:u}=nt(),v=P(),y=W(!1),i=W(!0),p=W(!1),k=P(),c=P(),E=xe(e,"menu"),b=x({get:()=>E.value,set:t=>{var r;E.value&&!t&&((r=k.value)!=null&&r.Î¨openChildren)||(E.value=t)}}),f=W(-1);let w=!1;const m=x(()=>{var t;return(t=v.value)==null?void 0:t.color}),S=x(()=>b.value?e.closeText:e.openText),{items:I,transformIn:T,transformOut:K}=yt(e),{textColorClasses:R,textColorStyles:re}=Ct(m),d=xe(e,"modelValue",[],t=>T(it(t)),t=>{const r=K(t);return e.multiple?r:r[0]??null}),G=Lt(),ee=x(()=>!!(e.chips||a.chip)),L=x(()=>ee.value||!!a.selection),j=W(!e.multiple&&!L.value?((ye=d.value[0])==null?void 0:ye.title)??"":""),V=x({get:()=>j.value,set:t=>{var r;if(j.value=t??"",!e.multiple&&!L.value&&(d.value=[H(e,t)]),t&&e.multiple&&((r=e.delimiters)!=null&&r.length)){const h=t.split(new RegExp(`(?:${e.delimiters.join("|")})+`));h.length>1&&(h.forEach(n=>{n=n.trim(),n&&N(H(e,n))}),j.value="")}t||(f.value=-1),i.value=!t}}),Ke=x(()=>typeof e.counterValue=="function"?e.counterValue(d.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?d.value.length:V.value.length);O(j,t=>{w?Ve(()=>w=!1):y.value&&!b.value&&(b.value=!0),s("update:search",t)}),O(d,t=>{var r;!e.multiple&&!L.value&&(j.value=((r=t[0])==null?void 0:r.title)??"")});const{filteredItems:te,getMatches:Ge}=Tt(e,I,()=>i.value?"":V.value),$=x(()=>e.hideSelected?te.value.filter(t=>!d.value.some(r=>r.value===t.value)):te.value),Qe=x(()=>d.value.map(t=>t.value)),ae=x(()=>{var r;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&V.value===((r=$.value[0])==null?void 0:r.title))&&$.value.length>0&&!i.value&&!p.value}),ie=x(()=>e.hideNoData&&!$.value.length||e.readonly||(G==null?void 0:G.isReadonly.value)),ce=P(),{onListScroll:We,onListKeydown:ze}=bt(ce,v);function He(t){w=!0,e.openOnClear&&(b.value=!0)}function Xe(){ie.value||(b.value=!0)}function Je(t){ie.value||(y.value&&(t.preventDefault(),t.stopPropagation()),b.value=!b.value)}function Ye(t){var n;if(ct(t)||e.readonly||G!=null&&G.isReadonly.value)return;const r=v.value.selectionStart,h=d.value.length;if((f.value>-1||["Enter","ArrowDown","ArrowUp"].includes(t.key))&&t.preventDefault(),["Enter","ArrowDown"].includes(t.key)&&(b.value=!0),["Escape"].includes(t.key)&&(b.value=!1),["Enter","Escape","Tab"].includes(t.key)&&(ae.value&&["Enter","Tab"].includes(t.key)&&N(te.value[0]),i.value=!0),t.key==="ArrowDown"&&ae.value&&((n=ce.value)==null||n.focus("next")),t.key==="Enter"&&V.value&&(N(H(e,V.value)),L.value&&(j.value="")),["Backspace","Delete"].includes(t.key)){if(!e.multiple&&L.value&&d.value.length>0&&!V.value)return N(d.value[0],!1);if(~f.value){const g=f.value;N(d.value[f.value],!1),f.value=g>=h-1?h-2:g}else t.key==="Backspace"&&!V.value&&(f.value=h-1)}if(e.multiple){if(t.key==="ArrowLeft"){if(f.value<0&&r>0)return;const g=f.value>-1?f.value-1:h-1;d.value[g]?f.value=g:(f.value=-1,v.value.setSelectionRange(V.value.length,V.value.length))}if(t.key==="ArrowRight"){if(f.value<0)return;const g=f.value+1;d.value[g]?f.value=g:(f.value=-1,v.value.setSelectionRange(0,0))}}}function Ze(){var t;y.value&&(i.value=!0,(t=v.value)==null||t.focus())}function N(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!t||t.props.disabled))if(e.multiple){const h=d.value.findIndex(g=>e.valueComparator(g.value,t.value)),n=r??!~h;if(~h){const g=n?[...d.value,t]:[...d.value];g.splice(h,1),d.value=g}else n&&(d.value=[...d.value,t]);e.clearOnSelect&&(V.value="")}else{const h=r!==!1;d.value=h?[t]:[],j.value=h&&!L.value?t.title:"",Ve(()=>{b.value=!1,i.value=!0})}}function et(t){y.value=!0,setTimeout(()=>{p.value=!0})}function tt(t){p.value=!1}function at(t){(t==null||t===""&&!e.multiple&&!L.value)&&(d.value=[])}return O(y,(t,r)=>{if(!(t||t===r)){if(f.value=-1,b.value=!1,ae.value&&!p.value&&!d.value.some(h=>{let{value:n}=h;return n===$.value[0].value})){N($.value[0]);return}if(V.value){if(e.multiple){N(H(e,V.value));return}if(!L.value)return;d.value.some(h=>{let{title:n}=h;return n===V.value})?j.value="":N(H(e,V.value))}}}),O(b,()=>{if(!e.hideSelected&&b.value&&d.value.length){const t=$.value.findIndex(r=>d.value.some(h=>e.valueComparator(h.value,r.value)));ut&&window.requestAnimationFrame(()=>{var r;t>=0&&((r=c.value)==null||r.scrollToIndex(t))})}}),O(()=>e.items,(t,r)=>{b.value||y.value&&!r.length&&t.length&&(b.value=!0)}),ot(()=>{const t=!!(!e.hideNoData||$.value.length||a["prepend-item"]||a["append-item"]||a["no-data"]),r=d.value.length>0,h=Z.filterProps(e);return o(Z,Q({ref:v},h,{modelValue:V.value,"onUpdate:modelValue":[n=>V.value=n,at],focused:y.value,"onUpdate:focused":n=>y.value=n,validationValue:d.externalValue,counterValue:Ke.value,dirty:r,class:["v-combobox",{"v-combobox--active-menu":b.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!L.value,"v-combobox--selecting-index":f.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:e.readonly,placeholder:r?void 0:e.placeholder,"onClick:clear":He,"onMousedown:control":Xe,onKeydown:Ye}),{...a,default:()=>o(Y,null,[o(ht,Q({ref:k,modelValue:b.value,"onUpdate:modelValue":n=>b.value=n,activator:"parent",contentClass:"v-combobox__content",disabled:ie.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:Ze},e.menuProps),{default:()=>[t&&o(xt,Q({ref:ce,selected:Qe.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:n=>n.preventDefault(),onKeydown:ze,onFocusin:et,onFocusout:tt,onScrollPassive:We,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},e.listProps),{default:()=>{var n,g,F;return[(n=a["prepend-item"])==null?void 0:n.call(a),!$.value.length&&!e.hideNoData&&(((g=a["no-data"])==null?void 0:g.call(a))??o(we,{title:u(e.noDataText)},null)),o(Vt,{ref:c,renderless:!0,items:$.value},{default:M=>{var he;let{item:C,index:B,itemRef:_}=M;const be=Q(C.props,{ref:_,key:B,active:ae.value&&B===0?!0:void 0,onClick:()=>N(C,null)});return((he=a.item)==null?void 0:he.call(a,{item:C,index:B,props:be}))??o(we,Q(be,{role:"option"}),{prepend:le=>{let{isSelected:ne}=le;return o(Y,null,[e.multiple&&!e.hideSelected?o($t,{key:C.value,modelValue:ne,ripple:!1,tabindex:"-1"},null):void 0,C.props.prependAvatar&&o(St,{image:C.props.prependAvatar},null),C.props.prependIcon&&o(Ce,{icon:C.props.prependIcon},null)])},title:()=>{var le,ne;return i.value?C.title:zt(C.title,(le=Ge(C))==null?void 0:le.title,((ne=V.value)==null?void 0:ne.length)??0)}})}}),(F=a["append-item"])==null?void 0:F.call(a)]}})]}),d.value.map((n,g)=>{function F(_){_.stopPropagation(),_.preventDefault(),N(n,!1)}const M={"onClick:close":F,onKeydown(_){_.key!=="Enter"&&_.key!==" "||(_.preventDefault(),_.stopPropagation(),F(_))},onMousedown(_){_.preventDefault(),_.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},C=ee.value?!!a.chip:!!a.selection,B=C?st(ee.value?a.chip({item:n,index:g,props:M}):a.selection({item:n,index:g})):void 0;if(!(C&&!B))return o("div",{key:n.value,class:["v-combobox__selection",g===f.value&&["v-combobox__selection--selected",R.value]],style:g===f.value?re.value:{}},[ee.value?a.chip?o(_t,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:n.title}}},{default:()=>[B]}):o(Dt,Q({key:"chip",closable:e.closableChips,size:"small",text:n.title,disabled:n.props.disabled},M),null):B??o("span",{class:"v-combobox__selection-text"},[n.title,e.multiple&&g<d.value.length-1&&o("span",{class:"v-combobox__selection-comma"},[oe(",")])])])})]),"append-inner":function(){var M;for(var n=arguments.length,g=new Array(n),F=0;F<n;F++)g[F]=arguments[F];return o(Y,null,[(M=a["append-inner"])==null?void 0:M.call(a,...g),(!e.hideNoData||e.items.length)&&e.menuIcon?o(Ce,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:Je,onClick:rt,"aria-label":u(S.value),title:u(S.value)},null):void 0])}})}),kt({isFocused:y,isPristine:i,menu:b,search:V,selectionIndex:f,filteredItems:te,select:N},v)}}),Jt=J("br",null,null,-1),Yt={class:"text-h5 font-weight-bold mr-2"},Zt={class:"text-caption"},ea={class:"text-caption"},ta={class:"text-red text-caption"},aa=Te({__name:"FxQuote",props:{base:{},quote:{},amount:{},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:l}){const s=e,{base:a,quote:u,amount:v,modelValue:y}=pe(s),i=l,{currentWallet:p}=dt(),{fxProviders:k}=pe(Pe()),c=P((y==null?void 0:y.value)||{providerAddress:"",base:a.value,quote:u.value,amount:(v==null?void 0:v.value)||1}),E=P(void 0),b=x(()=>k.value.map(m=>({value:m.address,title:`${m.country} - ${m.bankCode} - ${m.quoteUrl.slice(0,70)}`}))),f=P(0);async function w(){if(!c.value.providerAddress)return;const m=k.value.find(I=>I.address===c.value.providerAddress);if(!m)return;const S=new URL(m.quoteUrl);S.searchParams.set("base",c.value.base),S.searchParams.set("quote",c.value.quote),S.searchParams.set("amount",c.value.amount.toString()),S.searchParams.set("origin",p);try{const T=await(await fetch(S.toString())).json();c.value.fxRate={rate:T.rate,signature:T.signature,rateTime:T.rateTime,expiryTime:T.expiryTime,signer:T.signerAddress},c.value.amount=v.value||1,i("update:modelValue",c.value),f.value=100;const K=setInterval(()=>{const R=new Date().getTime()/1e3,re=c.value.fxRate.expiryTime-R;f.value=Math.floor(re/(c.value.fxRate.expiryTime-c.value.fxRate.rateTime)*100),f.value<=0&&(clearInterval(K),c.value.fxRate=void 0)},1e3)}catch(I){c.value=void 0,E.value=I.message}}return O(()=>c.value.providerAddress,()=>{c.value.fxRate=void 0}),(m,S)=>(D(),q(jt,{class:"pl-3 pr-0 mb-3"},{default:A(()=>[o(Ae,{class:"d-flex align-center"},{default:A(()=>[o(ue,{class:"pl-0"},{default:A(()=>[o(Xt,{modelValue:c.value.providerAddress,"onUpdate:modelValue":S[0]||(S[0]=I=>c.value.providerAddress=I),items:z(b),"return-object":!1,label:"FX Provider",outlined:"",dense:"","hide-details":"",clearable:""},null,8,["modelValue","items"])]),_:1}),c.value.providerAddress?(D(),q(ue,{key:0,cols:"auto",class:"d-flex justify-center"},{default:A(()=>[o(Fe,{class:"mx-1",color:"primary",onClick:w},{default:A(()=>[oe(" Quote "),Jt,oe(U(z(a))+"/"+U(z(u)),1)]),_:1})]),_:1})):X("",!0),c.value.fxRate?(D(),q(ue,{key:1,class:"d-flex justify-center align-baseline flex-wrap"},{default:A(()=>[J("div",Yt,U(c.value.fxRate.rate),1),J("div",Zt,"= "+U(c.value.quote)+" "+U(z(mt)(z(v)*c.value.fxRate.rate,2)),1),J("div",ea,"valid until "+U(new Date(c.value.fxRate.expiryTime*1e3).toLocaleTimeString()),1)]),_:1})):X("",!0),E.value?(D(),q(ue,{key:2},{default:A(()=>[J("div",ta,U(E.value),1)]),_:1})):X("",!0)]),_:1}),c.value.fxRate?(D(),q(Ae,{key:0,class:"pr-3"},{default:A(()=>[o(At,{height:10,"model-value":f.value},null,8,["model-value"])]),_:1})):X("",!0)]),_:1}))}}),la={key:1,class:"d-flex justify-center"},ga=Te({__name:"transfer",setup(e){const l=Pe(),s=x(()=>l.selectedAccount),a=x(()=>{var w;return(w=l.selectedAccount)==null?void 0:w.account}),u=P(),v=P(""),y=P(""),i=P(),p=x(()=>!a.value||!i.value?!1:a.value.bank.currency!==i.value.bank.currency),k=P(),c=x(()=>i.value?`${i.value.bank.currency}: ${i.value.name} at ${i.value.bank.bic}`:""),E=x(()=>!(!a.value||!i.value||!u.value||p.value&&!k.value)),b=ft();async function f(){if(!a.value)throw new Error("Account not found");if(u.value<=0)throw new Error("Need a positive amount to transfer");if(!v.value)throw new Error("Account not found");if(p.value&&!k.value)throw new Error("Need FX rate to transfer");p.value&&k.value?await l.fxTransfer(a.value,i.value,u.value,k.value,y.value):await l.transfer(a.value,v.value,u.value,y.value),b.push(`/accounts/${a.value.address}`)}return O(v,async w=>{if(w){if(w.startsWith("0x")){const m=await l.loadAccount(w);console.log("decoded account",m),i.value=m}else{const m=await l.decodeIBAN(a.value,w);console.log("decoded IBAN",m),i.value=m}s.value&&await l.enforceReferential(s.value.account)}}),vt(async()=>{}),(w,m)=>{const S=Ft,I=aa;return D(),ke(Y,null,[o(S,{selected:s.value},null,8,["selected"]),a.value?(D(),ke("div",la,[o(Pt,{elevation:"3",class:"mt-3 w-100 w-md-50 w-lg-33"},{default:A(()=>[o(Rt,null,{default:A(()=>{var T,K;return[o(Z,{type:"number",modelValue:u.value,"onUpdate:modelValue":m[0]||(m[0]=R=>u.value=R),modelModifiers:{number:!0},label:"transfer amount",suffix:(T=a.value)==null?void 0:T.bank.currency},null,8,["modelValue","suffix"]),o(Z,{class:"mb-2",modelValue:v.value,"onUpdate:modelValue":m[1]||(m[1]=R=>v.value=R),label:"transfer to (address or IBAN)",hint:c.value,"persistent-hint":""},null,8,["modelValue","hint"]),p.value?(D(),q(I,{key:0,base:(K=a.value)==null?void 0:K.bank.currency,quote:i.value.bank.currency,amount:u.value,modelValue:k.value,"onUpdate:modelValue":m[2]||(m[2]=R=>k.value=R)},null,8,["base","quote","amount","modelValue"])):X("",!0),o(Z,{modelValue:y.value,"onUpdate:modelValue":m[3]||(m[3]=R=>y.value=R),label:"Label your payment"},null,8,["modelValue"])]}),_:1}),o(Nt,null,{default:A(()=>[o(Fe,{color:"primary",onClick:f,disabled:!E.value},{default:A(()=>[oe("Transfer")]),_:1},8,["disabled"])]),_:1})]),_:1})])):(D(),q(Et,{key:0,elevation:3,type:"card"}))],64)}}});export{ga as default};
