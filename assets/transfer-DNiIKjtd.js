import{u as Ee}from"./accounts-D7WxMkEl.js";import{g as de,p as ve,e as h,ao as Ie,m as Ne,a as Te,ap as oe,ad as fe,a4 as ot,r as R,s as Q,l as he,af as st,w as U,ag as Ve,Y as pe,X as rt,u as it,c as s,y as G,W as ct,aq as dt,ar as ke,S as J,as as vt,at as ft,H as ue,A as Fe,an as we,B as mt,E as O,M as D,F as P,O as X,P as W,J as z,I as B,o as gt,N as Ce,G as bt}from"./index-BI4dhWSs.js";import{t as yt}from"./formatting-CrmIf10V.js";/* empty css              */import{u as xt,t as H,c as ht,m as Vt,d as pt,e as kt,a as Se,f as wt}from"./VSelect-DJ_nTOQV.js";import{V as Y,f as Ct,m as St}from"./VTextField-D8IjpR-w.js";import{t as At,v as _t,j as Ae,w as Pt,f as Rt,x as Et,g as It,i as Nt,k as Tt}from"./VCard-Ca1lIbYd.js";import{u as Ft,m as Lt,_ as Dt,V as $t}from"./filter-W8oclBAH.js";import{d as jt,a as Le}from"./VInput-BgACklH0.js";import{b as Mt,V as Bt}from"./VChip-j1TCQZRM.js";import{V as Ut}from"./VContainer-B8I2ih0P.js";const De=oe.reduce((e,l)=>(e[l]={type:[Boolean,String,Number],default:!1},e),{}),$e=oe.reduce((e,l)=>{const r="offset"+fe(l);return e[r]={type:[String,Number],default:null},e},{}),je=oe.reduce((e,l)=>{const r="order"+fe(l);return e[r]={type:[String,Number],default:null},e},{}),_e={col:Object.keys(De),offset:Object.keys($e),order:Object.keys(je)};function Ot(e,l,r){let a=e;if(!(r==null||r===!1)){if(l){const u=l.replace(e,"");a+=`-${u}`}return e==="col"&&(a="v-"+a),e==="col"&&(r===""||r===!0)||(a+=`-${r}`),a.toLowerCase()}}const qt=["auto","start","end","center","baseline","stretch"],Kt=ve({cols:{type:[Boolean,String,Number],default:!1},...De,offset:{type:[String,Number],default:null},...$e,order:{type:[String,Number],default:null},...je,alignSelf:{type:String,default:null,validator:e=>qt.includes(e)},...Te(),...Ne()},"VCol"),ne=de()({name:"VCol",props:Kt(),setup(e,l){let{slots:r}=l;const a=h(()=>{const u=[];let c;for(c in _e)_e[c].forEach(d=>{const k=e[d],w=Ot(c,d,k);w&&u.push(w)});const b=u.some(d=>d.startsWith("v-col-"));return u.push({"v-col":!b||!e.cols,[`v-col-${e.cols}`]:e.cols,[`offset-${e.offset}`]:e.offset,[`order-${e.order}`]:e.order,[`align-self-${e.alignSelf}`]:e.alignSelf}),u});return()=>{var u;return Ie(e.tag,{class:[a.value,e.class],style:e.style},(u=r.default)==null?void 0:u.call(r))}}}),me=["start","end","center"],Me=["space-between","space-around","space-evenly"];function ge(e,l){return oe.reduce((r,a)=>{const u=e+fe(a);return r[u]=l(),r},{})}const Gt=[...me,"baseline","stretch"],Be=e=>Gt.includes(e),Ue=ge("align",()=>({type:String,default:null,validator:Be})),Qt=[...me,...Me],Oe=e=>Qt.includes(e),qe=ge("justify",()=>({type:String,default:null,validator:Oe})),Wt=[...me,...Me,"stretch"],Ke=e=>Wt.includes(e),Ge=ge("alignContent",()=>({type:String,default:null,validator:Ke})),Pe={align:Object.keys(Ue),justify:Object.keys(qe),alignContent:Object.keys(Ge)},zt={align:"align",justify:"justify",alignContent:"align-content"};function Ht(e,l,r){let a=zt[e];if(r!=null){if(l){const u=l.replace(e,"");a+=`-${u}`}return a+=`-${r}`,a.toLowerCase()}}const Xt=ve({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:Be},...Ue,justify:{type:String,default:null,validator:Oe},...qe,alignContent:{type:String,default:null,validator:Ke},...Ge,...Te(),...Ne()},"VRow"),Re=de()({name:"VRow",props:Xt(),setup(e,l){let{slots:r}=l;const a=h(()=>{const u=[];let c;for(c in Pe)Pe[c].forEach(b=>{const d=e[b],k=Ht(c,b,d);k&&u.push(k)});return u.push({"v-row--no-gutters":e.noGutters,"v-row--dense":e.dense,[`align-${e.align}`]:e.align,[`justify-${e.justify}`]:e.justify,[`align-content-${e.alignContent}`]:e.alignContent}),u});return()=>{var u;return Ie(e.tag,{class:["v-row",a.value,e.class],style:e.style},(u=r.default)==null?void 0:u.call(r))}}});function Jt(e,l,r){if(l==null)return e;if(Array.isArray(l))throw new Error("Multiple matches is not implemented");return typeof l=="number"&&~l?s(J,null,[s("span",{class:"v-combobox__unmask"},[e.substr(0,l)]),s("span",{class:"v-combobox__mask"},[e.substr(l,r)]),s("span",{class:"v-combobox__unmask"},[e.substr(l+r)])]):e}const Yt=ve({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Lt({filterKeys:["title"]}),...Vt({hideNoData:!0,returnObject:!0}),...ct(St({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),..._t({transition:!1})},"VCombobox"),Zt=de()({name:"VCombobox",props:Yt(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,l){var be;let{emit:r,slots:a}=l;const{t:u}=ot(),c=R(),b=Q(!1),d=Q(!0),k=Q(!1),w=R(),i=R(),F=he(e,"menu"),y=h({get:()=>F.value,set:t=>{var n;F.value&&!t&&((n=w.value)!=null&&n.Î¨openChildren.size)||(F.value=t)}}),v=Q(-1);let S=!1;const m=h(()=>{var t;return(t=c.value)==null?void 0:t.color}),p=h(()=>y.value?e.closeText:e.openText),{items:I,transformIn:N,transformOut:q}=xt(e),{textColorClasses:E,textColorStyles:se}=At(m),f=he(e,"modelValue",[],t=>N(st(t)),t=>{const n=q(t);return e.multiple?n:n[0]??null}),Z=jt(e),ee=h(()=>!!(e.chips||a.chip)),L=h(()=>ee.value||!!a.selection),$=Q(!e.multiple&&!L.value?((be=f.value[0])==null?void 0:be.title)??"":""),V=h({get:()=>$.value,set:t=>{var n;if($.value=t??"",!e.multiple&&!L.value&&(f.value=[H(e,t)]),t&&e.multiple&&((n=e.delimiters)!=null&&n.length)){const x=t.split(new RegExp(`(?:${e.delimiters.join("|")})+`));x.length>1&&(x.forEach(o=>{o=o.trim(),o&&T(H(e,o))}),$.value="")}t||(v.value=-1),d.value=!t}}),Qe=h(()=>typeof e.counterValue=="function"?e.counterValue(f.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?f.value.length:V.value.length);U($,t=>{S?pe(()=>S=!1):b.value&&!y.value&&(y.value=!0),r("update:search",t)}),U(f,t=>{var n;!e.multiple&&!L.value&&($.value=((n=t[0])==null?void 0:n.title)??"")});const{filteredItems:te,getMatches:We}=Ft(e,I,()=>d.value?"":V.value),j=h(()=>e.hideSelected?te.value.filter(t=>!f.value.some(n=>n.value===t.value)):te.value),ze=h(()=>f.value.map(t=>t.value)),re=h(()=>{var n;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&V.value===((n=j.value[0])==null?void 0:n.title))&&j.value.length>0&&!d.value&&!k.value}),ie=h(()=>e.hideNoData&&!j.value.length||Z.isReadonly.value||Z.isDisabled.value),ce=R(),He=ht(ce,c);function Xe(t){S=!0,e.openOnClear&&(y.value=!0)}function Je(){ie.value||(y.value=!0)}function Ye(t){ie.value||(b.value&&(t.preventDefault(),t.stopPropagation()),y.value=!y.value)}function Ze(t){var n;t.key!==" "&&ke(t)&&((n=c.value)==null||n.focus())}function et(t){var o;if(dt(t)||Z.isReadonly.value)return;const n=c.value.selectionStart,x=f.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(t.key)&&t.preventDefault(),["Enter","ArrowDown"].includes(t.key)&&(y.value=!0),["Escape"].includes(t.key)&&(y.value=!1),["Enter","Escape","Tab"].includes(t.key)&&(re.value&&["Enter","Tab"].includes(t.key)&&!f.value.some(g=>{let{value:_}=g;return _===j.value[0].value})&&T(te.value[0]),d.value=!0),t.key==="ArrowDown"&&re.value&&((o=ce.value)==null||o.focus("next")),t.key==="Enter"&&V.value&&(T(H(e,V.value)),L.value&&($.value="")),["Backspace","Delete"].includes(t.key)){if(!e.multiple&&L.value&&f.value.length>0&&!V.value)return T(f.value[0],!1);if(~v.value){t.preventDefault();const g=v.value;T(f.value[v.value],!1),v.value=g>=x-1?x-2:g}else t.key==="Backspace"&&!V.value&&(v.value=x-1);return}if(e.multiple)if(t.key==="ArrowLeft"){if(v.value<0&&n>0)return;const g=v.value>-1?v.value-1:x-1;f.value[g]?v.value=g:(v.value=-1,c.value.setSelectionRange(V.value.length,V.value.length))}else if(t.key==="ArrowRight"){if(v.value<0)return;const g=v.value+1;f.value[g]?v.value=g:(v.value=-1,c.value.setSelectionRange(0,0))}else~v.value&&ke(t)&&(v.value=-1)}function tt(){var t;e.eager&&((t=i.value)==null||t.calculateVisibleItems())}function at(){var t;b.value&&(d.value=!0,(t=c.value)==null||t.focus())}function T(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!t||t.props.disabled))if(e.multiple){const x=f.value.findIndex(g=>(e.valueComparator||Ve)(g.value,t.value)),o=n??!~x;if(~x){const g=o?[...f.value,t]:[...f.value];g.splice(x,1),f.value=g}else o&&(f.value=[...f.value,t]);e.clearOnSelect&&(V.value="")}else{const x=n!==!1;f.value=x?[t]:[],$.value=x&&!L.value?t.title:"",pe(()=>{y.value=!1,d.value=!0})}}function lt(t){b.value=!0,setTimeout(()=>{k.value=!0})}function nt(t){k.value=!1}function ut(t){(t==null||t===""&&!e.multiple&&!L.value)&&(f.value=[])}return U(b,(t,n)=>{if(!(t||t===n)&&(v.value=-1,y.value=!1,V.value)){if(e.multiple){T(H(e,V.value));return}if(!L.value)return;f.value.some(x=>{let{title:o}=x;return o===V.value})?$.value="":T(H(e,V.value))}}),U(y,()=>{if(!e.hideSelected&&y.value&&f.value.length){const t=j.value.findIndex(n=>f.value.some(x=>(e.valueComparator||Ve)(x.value,n.value)));rt&&window.requestAnimationFrame(()=>{var n;t>=0&&((n=i.value)==null||n.scrollToIndex(t))})}}),U(()=>e.items,(t,n)=>{y.value||b.value&&!n.length&&t.length&&(y.value=!0)}),it(()=>{const t=!!(!e.hideNoData||j.value.length||a["prepend-item"]||a["append-item"]||a["no-data"]),n=f.value.length>0,x=Y.filterProps(e);return s(Y,G({ref:c},x,{modelValue:V.value,"onUpdate:modelValue":[o=>V.value=o,ut],focused:b.value,"onUpdate:focused":o=>b.value=o,validationValue:f.externalValue,counterValue:Qe.value,dirty:n,class:["v-combobox",{"v-combobox--active-menu":y.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!L.value,"v-combobox--selecting-index":v.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:Z.isReadonly.value,placeholder:n?void 0:e.placeholder,"onClick:clear":Xe,"onMousedown:control":Je,onKeydown:et}),{...a,default:()=>s(J,null,[s(pt,G({ref:w,modelValue:y.value,"onUpdate:modelValue":o=>y.value=o,activator:"parent",contentClass:"v-combobox__content",disabled:ie.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:tt,onAfterLeave:at},e.menuProps),{default:()=>[t&&s(kt,G({ref:ce,selected:ze.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:o=>o.preventDefault(),onKeydown:Ze,onFocusin:lt,onFocusout:nt,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},He,e.listProps),{default:()=>{var o,g,_;return[(o=a["prepend-item"])==null?void 0:o.call(a),!j.value.length&&!e.hideNoData&&(((g=a["no-data"])==null?void 0:g.call(a))??s(Se,{key:"no-data",title:u(e.noDataText)},null)),s(wt,{ref:i,renderless:!0,items:j.value},{default:M=>{var xe;let{item:C,index:K,itemRef:A}=M;const ye=G(C.props,{ref:A,key:C.value,active:re.value&&K===0?!0:void 0,onClick:()=>T(C,null)});return((xe=a.item)==null?void 0:xe.call(a,{item:C,index:K,props:ye}))??s(Se,G(ye,{role:"option"}),{prepend:ae=>{let{isSelected:le}=ae;return s(J,null,[e.multiple&&!e.hideSelected?s(Mt,{key:C.value,modelValue:le,ripple:!1,tabindex:"-1"},null):void 0,C.props.prependAvatar&&s(Pt,{image:C.props.prependAvatar},null),C.props.prependIcon&&s(Ae,{icon:C.props.prependIcon},null)])},title:()=>{var ae,le;return d.value?C.title:Jt(C.title,(ae=We(C))==null?void 0:ae.title,((le=V.value)==null?void 0:le.length)??0)}})}}),(_=a["append-item"])==null?void 0:_.call(a)]}})]}),f.value.map((o,g)=>{function _(A){A.stopPropagation(),A.preventDefault(),T(o,!1)}const M={"onClick:close":_,onKeydown(A){A.key!=="Enter"&&A.key!==" "||(A.preventDefault(),A.stopPropagation(),_(A))},onMousedown(A){A.preventDefault(),A.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},C=ee.value?!!a.chip:!!a.selection,K=C?ft(ee.value?a.chip({item:o,index:g,props:M}):a.selection({item:o,index:g})):void 0;if(!(C&&!K))return s("div",{key:o.value,class:["v-combobox__selection",g===v.value&&["v-combobox__selection--selected",E.value]],style:g===v.value?se.value:{}},[ee.value?a.chip?s(Rt,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:o.title}}},{default:()=>[K]}):s(Bt,G({key:"chip",closable:e.closableChips,size:"small",text:o.title,disabled:o.props.disabled},M),null):K??s("span",{class:"v-combobox__selection-text"},[o.title,e.multiple&&g<f.value.length-1&&s("span",{class:"v-combobox__selection-comma"},[ue(",")])])])})]),"append-inner":function(){var M;for(var o=arguments.length,g=new Array(o),_=0;_<o;_++)g[_]=arguments[_];return s(J,null,[(M=a["append-inner"])==null?void 0:M.call(a,...g),(!e.hideNoData||e.items.length)&&e.menuIcon?s(Ae,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:Ye,onClick:vt,"aria-label":u(p.value),title:u(p.value),tabindex:"-1"},null):void 0])}})}),Ct({isFocused:b,isPristine:d,menu:y,search:V,selectionIndex:v,filteredItems:te,select:T},c)}}),ea={class:"text-h5 font-weight-bold mr-2"},ta={class:"text-caption"},aa={class:"text-caption"},la={class:"text-red text-caption"},na=Fe({__name:"FxQuote",props:{base:{},quote:{},amount:{},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:l}){const r=e,{base:a,quote:u,amount:c,modelValue:b}=we(r),d=l,{currentWallet:k}=mt(),{fxProviders:w}=we(Ee()),i=R((b==null?void 0:b.value)||{providerAddress:"",base:a.value,quote:u.value,amount:(c==null?void 0:c.value)||1}),F=R(void 0),y=h(()=>w.value.map(m=>({value:m.address,title:`${m.country} - ${m.bankCode} - ${m.quoteUrl.slice(0,70)}`}))),v=R(0);async function S(){if(!i.value.providerAddress)return;const m=w.value.find(I=>I.address===i.value.providerAddress);if(!m)return;const p=new URL(m.quoteUrl);p.searchParams.set("base",i.value.base),p.searchParams.set("quote",i.value.quote),p.searchParams.set("amount",i.value.amount.toString()),p.searchParams.set("origin",k);try{const N=await(await fetch(p.toString())).json();i.value.fxRate={rate:N.rate,signature:N.signature,rateTime:N.rateTime,expiryTime:N.expiryTime,signer:N.signerAddress},i.value.amount=c.value||1,d("update:modelValue",i.value),v.value=100;const q=setInterval(()=>{const E=new Date().getTime()/1e3,se=i.value.fxRate.expiryTime-E;v.value=Math.floor(se/(i.value.fxRate.expiryTime-i.value.fxRate.rateTime)*100),v.value<=0&&(clearInterval(q),i.value.fxRate=void 0)},1e3)}catch(I){i.value=void 0,F.value=I.message}}return U(()=>i.value.providerAddress,()=>{i.value.fxRate=void 0}),(m,p)=>(D(),O(Ut,{class:"pl-3 pr-0 mb-3"},{default:P(()=>[s(Re,{class:"d-flex align-center"},{default:P(()=>[s(ne,{class:"pl-0"},{default:P(()=>[s(Zt,{modelValue:i.value.providerAddress,"onUpdate:modelValue":p[0]||(p[0]=I=>i.value.providerAddress=I),items:W(y),"return-object":!1,label:"FX Provider",outlined:"",dense:"","hide-details":"",clearable:""},null,8,["modelValue","items"])]),_:1}),i.value.providerAddress?(D(),O(ne,{key:0,cols:"auto",class:"d-flex justify-center"},{default:P(()=>[s(Le,{class:"mx-1",color:"primary",onClick:S},{default:P(()=>[p[1]||(p[1]=ue(" Quote ")),p[2]||(p[2]=z("br",null,null,-1)),ue(B(W(a))+"/"+B(W(u)),1)]),_:1})]),_:1})):X("",!0),i.value.fxRate?(D(),O(ne,{key:1,class:"d-flex justify-center align-baseline flex-wrap"},{default:P(()=>[z("div",ea,B(i.value.fxRate.rate),1),z("div",ta," = "+B(i.value.quote)+" "+B(W(yt)(W(c)*i.value.fxRate.rate,2)),1),z("div",aa," valid until "+B(new Date(i.value.fxRate.expiryTime*1e3).toLocaleTimeString()),1)]),_:1})):X("",!0),F.value?(D(),O(ne,{key:2},{default:P(()=>[z("div",la,B(F.value),1)]),_:1})):X("",!0)]),_:1}),i.value.fxRate?(D(),O(Re,{key:0,class:"pr-3"},{default:P(()=>[s(Et,{height:10,"model-value":v.value},null,8,["model-value"])]),_:1})):X("",!0)]),_:1}))}}),ua={key:1,class:"d-flex justify-center"},ya=Fe({__name:"transfer",setup(e){const l=Ee(),r=h(()=>l.selectedAccount),a=h(()=>{var S;return(S=l.selectedAccount)==null?void 0:S.account}),u=R(),c=R(""),b=R(""),d=R(),k=h(()=>!a.value||!d.value?!1:a.value.bank.currency!==d.value.bank.currency),w=R(),i=h(()=>d.value?`${d.value.bank.currency}: ${d.value.name} at ${d.value.bank.bic}`:""),F=h(()=>!(!a.value||!d.value||!u.value||k.value&&!w.value)),y=bt();async function v(){if(!a.value)throw new Error("Account not found");if(u.value<=0)throw new Error("Need a positive amount to transfer");if(!c.value)throw new Error("Account not found");if(k.value&&!w.value)throw new Error("Need FX rate to transfer");k.value&&w.value?await l.fxTransfer(a.value,d.value,u.value,w.value,b.value):await l.transfer(a.value,c.value,u.value,b.value),y.push(`/accounts/${a.value.address}`)}return U(c,async S=>{if(S){if(S.startsWith("0x")){const m=await l.loadAccount(S);console.log("decoded account",m),d.value=m}else{const m=await l.decodeIBAN(a.value,S);console.log("decoded IBAN",m),d.value=m}r.value&&await l.enforceReferential(r.value.account)}}),gt(async()=>{}),(S,m)=>{const p=Dt,I=na;return D(),Ce(J,null,[s(p,{selected:r.value},null,8,["selected"]),a.value?(D(),Ce("div",ua,[s(It,{elevation:"3",class:"mt-3 w-100 w-md-50 w-lg-33"},{default:P(()=>[s(Nt,null,{default:P(()=>{var N,q;return[s(Y,{type:"number",modelValue:u.value,"onUpdate:modelValue":m[0]||(m[0]=E=>u.value=E),modelModifiers:{number:!0},label:"transfer amount",suffix:(N=a.value)==null?void 0:N.bank.currency},null,8,["modelValue","suffix"]),s(Y,{class:"mb-2",modelValue:c.value,"onUpdate:modelValue":m[1]||(m[1]=E=>c.value=E),label:"transfer to (address or IBAN)",hint:i.value,"persistent-hint":""},null,8,["modelValue","hint"]),k.value?(D(),O(I,{key:0,base:(q=a.value)==null?void 0:q.bank.currency,quote:d.value.bank.currency,amount:u.value,modelValue:w.value,"onUpdate:modelValue":m[2]||(m[2]=E=>w.value=E)},null,8,["base","quote","amount","modelValue"])):X("",!0),s(Y,{modelValue:b.value,"onUpdate:modelValue":m[3]||(m[3]=E=>b.value=E),label:"Label your payment"},null,8,["modelValue"])]}),_:1}),s(Tt,null,{default:P(()=>[s(Le,{color:"primary",onClick:v,disabled:!F.value},{default:P(()=>m[4]||(m[4]=[ue("Transfer")])),_:1},8,["disabled"])]),_:1})]),_:1})])):(D(),O($t,{key:0,elevation:3,type:"card"}))],64)}}});export{ya as default};
