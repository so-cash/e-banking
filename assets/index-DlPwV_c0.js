import{t as p}from"./formatting-B24v2g9C.js";import{u as k}from"./accounts-CZfYxCi2.js";import{g as V,h as C,i as v,k as P}from"./VCard-DVcoeF_5.js";import{a as g,V as N}from"./VSelect-DS2BT9Sc.js";import{a as w}from"./VInput-CHHdvrRo.js";import{A,f as L,r as y,o as R,N as n,C as S,D as s,O as U,H as T,c as i,I as l,L as c,J as o,ak as B,y as I}from"./index-sYn4zpRH.js";import"./VTextField-tELjM1Q6.js";import"./VChip-ClBnAa4N.js";const J={class:"font-weight-black mx-1"},O={class:"text-caption mx-1"},D={class:"text-caption mx-1"},j=c("p",null,"Select the account to pay with",-1),E=A({__name:"index",setup(H){const m=k(),_=L(()=>m.accounts.filter(r=>{var t;return r.bank.currency==((t=a.value)==null?void 0:t.ccy)})),u=y(),f=y(),a=y();function d(r,t){const e=new URL(f.value.href);r&&e.searchParams.append("r",btoa(JSON.stringify(r))),t&&e.searchParams.append("error",t),window.location.href=e.href}async function b(){if(!u.value)return;a.value||d(void 0,"No payment instruction found");const{tx:r,error:t}=await m.approve(u.value,a.value.execAddress,a.value.amount);t?d(void 0,t):d({msg:"Payment successful",tx:r,id:a.value.id,account:u.value.address,amount:a.value.amount,ccy:a.value.ccy})}return R(()=>{const r=new URL(window.location.href);if(!r.searchParams.has("redirect"))throw new Error("No redirect URL found in the URL");f.value=new URL(r.searchParams.get("redirect")),r.searchParams.has("i")||d(void 0,"No payment instruction found in the URL");const t=atob(r.searchParams.get("i"));a.value=JSON.parse(t),m.loadAccounts()}),(r,t)=>n(a)?(T(),S(V,{key:0},{default:s(()=>[i(C,null,{default:s(()=>[l(" Payment Validation ")]),_:1}),i(v,{class:"mx-3"},{default:s(()=>[c("ul",null,[c("li",null,[l("Pay "),c("span",J,o(n(p)(n(a).amount))+" "+o(n(a).ccy),1)]),c("li",null,"To: "+o(n(a).beneficiary)+" ("+o(n(a).iban)+")",1),c("li",null,[l("Reference: "),c("span",O,o(n(a).id),1),l("("+o(n(f).origin)+")",1)]),c("li",null,[l("Allowing "),c("span",D,o(n(a).execAddress),1),l("to debit your account")])])]),_:1}),i(v,null,{default:s(()=>[j,i(g,{items:n(_),"item-title":"name","item-value":"address","return-object":"","single-line":"",clearable:"","model-value":n(u),"onUpdate:modelValue":t[0]||(t[0]=e=>B(u)?u.value=e:null)},{selection:s(({item:e})=>[c("div",null,o(e.raw.name)+" : "+o(n(p)(e.raw.balance,e.raw.bank.decimals))+" "+o(e.raw.bank.currency),1)]),item:s(({item:e,props:x})=>[i(N,I(x,{title:""}),{default:s(()=>[l(o(e.raw.name)+" : "+o(n(p)(e.raw.balance,e.raw.bank.decimals))+" "+o(e.raw.bank.currency),1)]),_:2},1040)]),_:1},8,["items","model-value"])]),_:1}),i(P,null,{default:s(()=>[i(w,{color:"primary",disabled:!n(u),onClick:b},{default:s(()=>[l("Confirm")]),_:1},8,["disabled"]),i(w,{color:"error",onClick:t[1]||(t[1]=e=>d(void 0,"cancel by user"))},{default:s(()=>[l("Cancel")]),_:1})]),_:1})]),_:1})):U("",!0)}}),h={};typeof h=="function"&&h(E);export{E as default};
